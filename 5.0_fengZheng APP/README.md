# 城市改造数据收集平台

基于社会5.0理念的城市改造数据收集应用，通过收集市民意愿，分析城市交通设施需求。

## 功能特性

### 1. 地图功能
- 杭州城市地图（基于OpenStreetMap）
- 点击地图选择位置
- 获取用户GPS定位
- 可视化所有标记点

### 2. 图像识别
- 手机摄像头拍摄
- AI识别道路、河流、桥梁等
- 分析交通流量和地形特征
- 评估适合的改造方案

### 3. NPC专家讨论（两步流程）
- **第一步：风筝方案讨论**（核心要点）
  - 与专家讨论如何用"风筝"作为过街/过河的创新方案
  - 这是基于社会5.0理念的想象性讨论
  - 分析物理可行性、技术挑战、创新意义
  
- **第二步：实际改造方案**
  - 基于第一步的讨论，从实际角度分析
  - 讨论适合的改造方案（天桥/桥梁/斑马线等）
  - 提供专业建议和设计要点

- **专家类型**：
  - **物理学家**：从物理环境角度分析
  - **工程师**：从工程实践角度建议
  - **历史学家**：从城市文脉角度讨论

### 4. 数据收集与分析
- 收集用户标记点（位置、类型、建议）
- 统计不同类型地点数量
- 可视化标记分布
- 导出数据用于城市规划分析

## 使用方法

### 运行应用
```bash
streamlit run city_app.py
```

### 使用流程
1. **获取定位**：点击"获取当前位置"或在地图上点击
2. **拍摄照片**：点击"打开摄像头"拍摄地点
3. **AI识别**：系统自动识别图像内容
4. **NPC讨论**：选择专家讨论改造方案
5. **提交标记**：保存您的建议和位置

## 技术栈

- **前端**：Streamlit
- **地图**：Folium + OpenStreetMap
- **AI识别**：智谱AI视觉模型
- **数据存储**：JSON文件
- **NPC对话**：智谱AI + 角色扮演系统

## 数据格式

每个标记点包含：
- 经纬度坐标
- 时间戳
- 地点类型（道路/河流/桥梁/天桥/斑马线）
- AI图像分析结果
- NPC讨论内容
- 用户建议

## 应用场景

基于社会5.0理念，通过收集市民意愿：
- 识别需要建造天桥的地点
- 识别需要建造桥梁的地点
- 识别需要斑马线的地点
- 分析城市交通设施需求分布
- 为城市规划提供数据支持

## 文件说明

- `city_app.py` - 主应用文件
- `data_storage.py` - 数据存储模块
- `vision_api.py` - AI图像识别模块
- `api.py` - 智谱AI API调用
- `chat.py` - NPC对话模块
- `roles.py` - NPC角色设定
- `user_marks.json` - 用户标记数据（自动生成）

## 注意事项

1. 需要浏览器允许位置访问权限
2. 需要浏览器允许摄像头访问权限
3. 需要配置智谱AI API密钥（在api.py中）
4. 数据存储在本地JSON文件中

